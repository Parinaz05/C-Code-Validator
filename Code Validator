#include <iostream>
#include <string>
#include <vector>
#include <exception>
using namespace std;

// ----------------------
// Base Class
// ----------------------
class CodeValidator {
public:
    virtual bool validate(const vector<string>& code) = 0;  // Pure virtual function for polymorphism
    virtual ~CodeValidator() {} // Virtual destructor
};

// ----------------------
// Derived Class
// ----------------------
class SimpleValidator : public CodeValidator {
public:
    bool validate(const vector<string>& code) override {
        bool hasInclude = false;
        bool hasMain = false;
        int openBraces = 0, closeBraces = 0;

        for (int i = 0; i < code.size(); ++i) {
            string line = code[i];

            // Check for #include
            if (line.find("#include") != string::npos)
                hasInclude = true;

            // Check for main()
            if (line.find("main") != string::npos)
                hasMain = true;

            // Count braces
            for (char c : line) {
                if (c == '{') openBraces++;
                else if (c == '}') closeBraces++;
            }

            // Check for missing semicolon
            if ((line.find("int") != string::npos ||
                 line.find("float") != string::npos ||
                 line.find("cout") != string::npos) &&
                line.find('{') == string::npos &&
                line.find('}') == string::npos &&
                line.back() != ';') 
            {
                throw runtime_error("âŒ Validation Error: Missing semicolon at line " + to_string(i + 1));
            }
        }

        // Other validations
        if (!hasInclude)
            throw runtime_error("âŒ Validation Error: Missing #include statement.");
        if (!hasMain)
            throw runtime_error("âŒ Validation Error: Missing main() function.");
        if (openBraces != closeBraces)
            throw runtime_error("âŒ Validation Error: Unmatched braces found.");

        // If all checks pass
        return true;
    }
};

// ----------------------
// Main Function
// ----------------------
int main() {
    cout << "=== C++ Code Validator ===" << endl;

    SimpleValidator validator;
    bool isValid = false;  // Track validity of entered code

    while (!isValid) {
        cout << "\nEnter your C++ code (type END on a new line to finish):" << endl;

        // Dynamic memory allocation for storing code
        vector<string>* codeLines = new vector<string>();

        string line;
        while (true) {
            getline(cin, line);
            if (line == "END") break;
            codeLines->push_back(line);
        }

        try {
            if (validator.validate(*codeLines)) {
                cout << "âœ… Code is valid! No syntax issues found.\n";
                isValid = true; // Stop asking once valid
            }
        }
        catch (exception& e) {
            cout << e.what() << endl;
            cout << "ðŸ” Please try again and fix the above issue.\n";
        }

        delete codeLines;  // Free allocated memory
    }

    cout << "\nProgram finished successfully." << endl;
    return 0;
}


